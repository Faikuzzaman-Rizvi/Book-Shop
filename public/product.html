<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Boimela | Product</title>
  <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
 <link rel="stylesheet" href="./css/product.css">
</head>

<body>
  <!-- ==== HEADER ==== -->
  <header>
    <div class="logo">Boimela</div>
    <div class="nav-right">
      <a href="cart.html">üõí Cart (<span id="cartCount">0</span>)</a>
      <a href="Login.html">Login</a>
    </div>
  </header>

  <!-- ==== FORM ==== -->
  <section class="product-section">
    <form id="myform" enctype="multipart/form-data">
      <h1>Add Product</h1>
      <input type="hidden" id="productId">
      <input type="text" id="name" placeholder="Product Name" required>
      <input type="number" id="price" placeholder="Price" required>
      <input type="number" id="stock" placeholder="Stock" required>
      <textarea id="description" placeholder="Description"></textarea>
      <input type="file" id="file">
      <button type="button" id="saveBtn">Save Product</button>
      <a href="index.html" class="back-link">‚Üê Back to Home</a>
    </form>
  </section>

  <!-- ==== FOOTER ==== -->
  <footer>
    <p>&copy; 2025 Fayekuzzaman | ASP.NET Developer. All rights reserved.</p>
  </footer>

  <script>
    const url = 'http://localhost:5000/api/products';
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');

    $(async function () {
      if (id) {
        const res = await fetch(`${url}/${id}`);
        const p = await res.json();
        $("#productId").val(p._id);
        $("#name").val(p.name);
        $("#price").val(p.price);
        $("#stock").val(p.stock);
        $("#description").val(p.description);
      }

      $("#saveBtn").click(async function () {
        const formData = new FormData();
        formData.append("name", $("#name").val());
        formData.append("price", $("#price").val());
        formData.append("stock", $("#stock").val());
        formData.append("description", $("#description").val());
        if ($("#file")[0].files[0]) formData.append("file", $("#file")[0].files[0]);

        try {
          if (id) {
            await fetch(`${url}/${id}`, { method: "PUT", body: formData });
          } else {
            await fetch(url, { method: "POST", body: formData });
          }

          alert("Product saved successfully!");
          if (!id) $("#myform")[0].reset();

        } catch (err) {
          console.log(err);
          alert("Something went wrong, try again!");
        }
      });
    });
  </script>
</body>

</html>
